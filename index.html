<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FitTrack Pro ‚Äî Fitness & Wellness Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
/* 2. styles.css (Embedded here for a single-file solution)
*/
:root {
    --primary-color: #4a90e2; /* Blue */
    --secondary-color: #7ed321; /* Green */
    --background-color: #f7f9fc;
    --card-background: #ffffff;
    --text-color: #333333;
    --light-text-color: #666666;
    --shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
    --border-radius: 12px;
}

* {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
    font-family: 'Poppins', sans-serif;
}

body {
    background-color: var(--background-color);
    color: var(--text-color);
    line-height: 1.6;
    min-height: 100vh;
    padding: 20px;
}

/* --- Utility Classes --- */
.container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
}

.section {
    display: none; /* Controlled by JavaScript for single-page navigation */
}

.active-section {
    display: block;
    animation: fadeIn 0.5s ease-out;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

/* --- Header & Navigation --- */
header {
    background-color: var(--card-background);
    padding: 15px 30px;
    box-shadow: var(--shadow);
    border-radius: var(--border-radius);
    margin-bottom: 25px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

h1.logo {
    font-size: 1.8rem;
    color: var(--primary-color);
    font-weight: 700;
}

nav button {
    background: none;
    border: none;
    color: var(--light-text-color);
    padding: 8px 15px;
    cursor: pointer;
    font-size: 1rem;
    transition: color 0.3s, background-color 0.3s, transform 0.2s;
    border-radius: 8px;
    margin-left: 5px;
}

nav button:hover {
    color: var(--primary-color);
    background-color: rgba(74, 144, 226, 0.1);
}

nav button.active {
    background-color: var(--primary-color);
    color: var(--card-background);
    font-weight: 600;
}

nav button:active {
    transform: scale(0.98);
}

/* --- Card Styles --- */
.card {
    background-color: var(--card-background);
    padding: 25px;
    border-radius: var(--border-radius);
    box-shadow: var(--shadow);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.card:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
}

h2 {
    font-size: 1.6rem;
    margin-bottom: 20px;
    color: var(--text-color);
    border-bottom: 2px solid rgba(74, 144, 226, 0.1);
    padding-bottom: 10px;
}

/* --- Progress Bar Styles --- */
.progress-bar-container {
    margin-bottom: 20px;
}

.progress-label {
    display: flex;
    justify-content: space-between;
    font-weight: 600;
    margin-bottom: 5px;
    color: var(--primary-color);
}

.progress-bar-track {
    background-color: #e0e0e0;
    height: 10px;
    border-radius: 5px;
    overflow: hidden;
}

.progress-bar-fill {
    height: 100%;
    background-color: var(--secondary-color);
    width: 0%; /* JS sets this */
    transition: width 0.6s ease-out;
}

/* --- Form Styles --- */
form {
    display: grid;
    gap: 15px;
    padding: 20px;
    border: 1px solid #e0e0e0;
    border-radius: var(--border-radius);
    background-color: #fcfcfc;
}

label {
    font-weight: 600;
    display: block;
    margin-bottom: 5px;
}

input[type="text"], 
input[type="number"] {
    width: 100%;
    padding: 10px;
    border: 1px solid #ccc;
    border-radius: 6px;
    font-size: 1rem;
    transition: border-color 0.3s;
}

input:focus {
    border-color: var(--primary-color);
    outline: none;
    box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.2);
}

.btn-primary, 
.btn-secondary {
    padding: 12px 20px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-size: 1rem;
    font-weight: 600;
    transition: background-color 0.3s, transform 0.2s;
    text-transform: uppercase;
}

.btn-primary {
    background-color: var(--primary-color);
    color: var(--card-background);
}

.btn-primary:hover {
    background-color: #3b7ad0;
}

.btn-secondary {
    background-color: #cccccc;
    color: var(--text-color);
}

.btn-secondary:hover {
    background-color: #b3b3b3;
}

.error-message {
    color: #ff4d4f;
    font-size: 0.9rem;
    margin-top: -10px;
}

/* --- Grid Layouts (Pages) --- */

/* Page 1 - Wellness Overview Dashboard */
#wellness-overview {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 25px;
}

.metric-card {
    text-align: center;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
}

.metric-card .icon-circle {
    background-color: rgba(74, 144, 226, 0.1);
    color: var(--primary-color);
    width: 60px;
    height: 60px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.8rem;
    margin-bottom: 10px;
}

.metric-value {
    font-size: 2.5rem;
    font-weight: 700;
    color: var(--text-color);
    margin-bottom: 5px;
}

.metric-label {
    font-size: 1rem;
    color: var(--light-text-color);
}

#clock-card {
    grid-column: 1 / -1;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
}

#live-clock {
    font-size: 4rem;
    font-weight: 300;
    color: var(--primary-color);
    letter-spacing: 2px;
    padding: 10px;
}


/* Page 2 - Activity Log */
#activity-log {
    display: grid;
    grid-template-columns: 1fr;
    gap: 25px;
}

.filter-buttons {
    display: flex;
    gap: 10px;
    margin-bottom: 20px;
    flex-wrap: wrap;
}

.filter-buttons button {
    background-color: #e0e0e0;
    color: var(--text-color);
    font-weight: 500;
    padding: 10px 15px;
    border: none;
    border-radius: 20px;
    cursor: pointer;
    transition: background-color 0.3s, color 0.3s;
}

.filter-buttons button:hover:not(.active) {
    background-color: #cccccc;
}

.filter-buttons button.active {
    background-color: var(--secondary-color);
    color: var(--card-background);
}

.activity-list {
    list-style: none;
    display: grid;
    gap: 10px;
}

.activity-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px;
    background-color: var(--card-background);
    border-radius: var(--border-radius);
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
}

.activity-details {
    flex-grow: 1;
}

.activity-name {
    font-weight: 600;
    color: var(--primary-color);
    font-size: 1.1rem;
}

.activity-meta {
    font-size: 0.9rem;
    color: var(--light-text-color);
}

.activity-time-tag {
    background-color: var(--secondary-color);
    color: white;
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 0.8rem;
    font-weight: 600;
    margin-right: 15px;
    min-width: 60px;
    text-align: center;
}

/* Page 3 - Meal Planner */
#meal-planner-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 25px;
}

.meal-section h3 {
    background-color: var(--primary-color);
    color: white;
    padding: 10px 15px;
    border-radius: 8px 8px 0 0;
    margin-top: -25px; /* Pull it up into the card top */
    margin-left: -25px;
    margin-right: -25px;
    margin-bottom: 20px;
    font-size: 1.2rem;
}

.meal-section .card {
    padding-top: 25px; /* Adjust padding after h3 moved up */
}

.meal-list {
    list-style: none;
    gap: 8px;
    display: flex;
    flex-direction: column;
}

.meal-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 0;
    border-bottom: 1px dashed #e0e0e0;
}

.meal-item:last-child {
    border-bottom: none;
}

.meal-item-name {
    font-weight: 500;
}

.meal-item-details {
    display: flex;
    align-items: center;
    gap: 15px;
}

.meal-calories {
    font-weight: 600;
    color: #e67e22; /* Orange */
}

.remove-meal-btn {
    background: none;
    border: none;
    color: #e74c3c;
    cursor: pointer;
    font-size: 1rem;
    transition: color 0.3s;
}

.remove-meal-btn:hover {
    color: #c0392b;
}

.total-calories-card {
    grid-column: 1 / -1;
    text-align: center;
    background-color: #f0f8ff;
    border: 1px solid var(--primary-color);
}

.total-calories-card h2 {
    border-bottom: none;
}

#total-daily-calories {
    font-size: 3rem;
    font-weight: 700;
    color: var(--primary-color);
}

/* Page 4 - Insights & Summary */
.graph-container {
    background-color: var(--card-background);
    padding: 25px;
    border-radius: var(--border-radius);
    box-shadow: var(--shadow);
    margin-bottom: 25px;
}

.bar-chart {
    display: flex;
    justify-content: space-around;
    align-items: flex-end;
    height: 250px;
    border-bottom: 1px solid #ccc;
    padding-bottom: 10px;
}

.bar {
    width: 10%;
    background-color: var(--primary-color);
    margin: 0 1%;
    border-radius: 4px 4px 0 0;
    position: relative;
    transition: height 0.6s ease-out;
}

.bar-label {
    position: absolute;
    bottom: -20px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 0.8rem;
    color: var(--light-text-color);
}

.bar-value {
    position: absolute;
    top: -20px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 0.8rem;
    font-weight: 600;
    color: var(--primary-color);
}

#calorie-graph .bar {
    background-color: #e67e22; /* Orange for calories */
}

.summary-details {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
}

.summary-card {
    background-color: #fffaf0; /* Light gold tint */
    border: 1px solid #f39c12;
    padding: 20px;
}

.summary-value {
    font-size: 2rem;
    font-weight: 700;
    color: #f39c12;
}


/* --- Custom Modal Styles --- */
.modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.6);
    display: none; /* Hidden by default */
    justify-content: center;
    align-items: center;
    z-index: 1000;
    backdrop-filter: blur(5px);
    opacity: 0;
    transition: opacity 0.3s ease;
}

.modal-overlay.active {
    display: flex;
    opacity: 1;
}

.modal-content {
    background: var(--card-background);
    padding: 40px;
    border-radius: var(--border-radius);
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    width: 90%;
    max-width: 400px;
    text-align: center;
    transform: scale(0.9);
    transition: transform 0.3s ease;
}

.modal-overlay.active .modal-content {
    transform: scale(1);
}

.modal-icon {
    font-size: 3rem;
    color: var(--secondary-color);
    margin-bottom: 15px;
}

.modal-content h3 {
    font-size: 1.5rem;
    color: var(--text-color);
    margin-bottom: 10px;
}

.modal-content p {
    color: var(--light-text-color);
    margin-bottom: 20px;
}


/* --- Responsiveness (Media Queries) --- */
@media (max-width: 768px) {
    body {
        padding: 10px;
    }
    header {
        flex-direction: column;
        gap: 10px;
        padding: 15px 15px;
    }
    h1.logo {
        font-size: 1.5rem;
    }
    nav button {
        font-size: 0.9rem;
        padding: 6px 10px;
    }
    
    /* Page 1 */
    #live-clock {
        font-size: 3rem;
    }
    
    /* Page 3 */
    #meal-planner-grid {
        grid-template-columns: 1fr;
    }
    
    .meal-section h3 {
        margin-left: -15px;
        margin-right: -15px;
        padding: 10px 15px;
    }

    .meal-section .card {
        padding: 15px;
    }
    
    /* Page 4 */
    .bar {
        width: 15%;
    }
}

@media (max-width: 480px) {
    h2 {
        font-size: 1.4rem;
    }
    .metric-value {
        font-size: 2rem;
    }
    .metric-card .icon-circle {
        width: 50px;
        height: 50px;
        font-size: 1.5rem;
    }
    .activity-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 5px;
    }
    .activity-meta {
        order: 3;
    }
    .activity-time-tag {
        order: 1;
        margin-right: 0;
    }
    .activity-details {
        order: 2;
    }
    .filter-buttons {
        justify-content: center;
    }
}

    </style>
</head>
<body>
    <div id="app">
        <header>
            <h1 class="logo">FitTrack Pro</h1>
            <nav id="main-nav">
                <button data-section="wellness-overview" class="active"><i class="fas fa-home"></i> Dashboard</button>
                <button data-section="activity-log"><i class="fas fa-running"></i> Activity</button>
                <button data-section="meal-planner"><i class="fas fa-utensils"></i> Meals</button>
                <button data-section="insights-summary"><i class="fas fa-chart-line"></i> Insights</button>
            </nav>
        </header>

        <main class="container">
            
            <section id="wellness-overview" class="section active-section">
                <h2>üìä Wellness Overview</h2>
                
                <div id="metric-cards">
                    
                    <div class="card metric-card">
                        <div class="icon-circle"><i class="fas fa-shoe-prints"></i></div>
                        <div class="metric-value" id="steps-value">0</div>
                        <div class="metric-label">Steps Taken (Goal: 10k)</div>
                        <div class="progress-bar-container">
                            <div class="progress-label"><span>Progress</span><span id="steps-percent">0%</span></div>
                            <div class="progress-bar-track"><div class="progress-bar-fill" id="steps-progress"></div></div>
                        </div>
                    </div>
                    
                    <div class="card metric-card">
                        <div class="icon-circle" style="background-color: rgba(230, 126, 34, 0.1); color: #e67e22;"><i class="fas fa-fire"></i></div>
                        <div class="metric-value" id="calories-value">0</div>
                        <div class="metric-label">Calories Burned (Goal: 500)</div>
                        <div class="progress-bar-container">
                            <div class="progress-label"><span>Progress</span><span id="calories-percent">0%</span></div>
                            <div class="progress-bar-track"><div class="progress-bar-fill" id="calories-progress" style="background-color: #e67e22;"></div></div>
                        </div>
                    </div>

                    <div class="card metric-card">
                        <div class="icon-circle" style="background-color: rgba(52, 152, 219, 0.1); color: #3498db;"><i class="fas fa-tint"></i></div>
                        <div class="metric-value" id="water-value">0</div>
                        <div class="metric-label">Water Intake (Goal: 2L)</div>
                        <div class="progress-bar-container">
                            <div class="progress-label"><span>Progress</span><span id="water-percent">0%</span></div>
                            <div class="progress-bar-track"><div class="progress-bar-fill" id="water-progress" style="background-color: #3498db;"></div></div>
                        </div>
                    </div>
                    
                    <div class="card" id="clock-card">
                        <div class="icon-circle"><i class="fas fa-clock"></i></div>
                        <div id="live-clock">--:--:--</div>
                        <p class="metric-label">Live Digital Clock</p>
                    </div>

                </div>
                
                <div style="text-align: center; margin-top: 30px;">
                    <button class="btn-primary" onclick="navigate('activity-log')">Go to Activity Log (Page 2) <i class="fas fa-arrow-right"></i></button>
                </div>
            </section>

            <section id="activity-log" class="section">
                <h2>üèÉ Activity Log</h2>

                <div class="card">
                    <h3>Add New Activity</h3>
                    <form id="add-activity-form">
                        <label for="activity-name">Activity Name</label>
                        <input type="text" id="activity-name" placeholder="e.g., Running, Cycling" required>

                        <label for="activity-duration">Duration (minutes)</label>
                        <input type="number" id="activity-duration" min="1" placeholder="e.g., 30" required>

                        <label for="activity-calories">Calories Burned</label>
                        <input type="number" id="activity-calories" min="1" placeholder="e.g., 250" required>
                        
                        <button type="submit" class="btn-primary">Log Activity</button>
                    </form>
                </div>

                <div class="card">
                    <h3>Activities History</h3>
                    <div class="filter-buttons">
                        <button class="activity-filter-btn active" data-filter="all">All</button>
                        <button class="activity-filter-btn" data-filter="Morning">Morning</button>
                        <button class="activity-filter-btn" data-filter="Afternoon">Afternoon</button>
                        <button class="activity-filter-btn" data-filter="Evening">Evening</button>
                    </div>
                    
                    <ul class="activity-list" id="activities-list">
                        </ul>
                </div>

                <div style="text-align: center; margin-top: 30px;">
                    <button class="btn-primary" onclick="navigate('meal-planner')">Go to Meal Planner (Page 3) <i class="fas fa-arrow-right"></i></button>
                </div>
            </section>

            <section id="meal-planner" class="section">
                <h2>üçΩÔ∏è Meal Planner</h2>

                <div class="card total-calories-card">
                    <h2>Total Daily Calories: <span id="total-daily-calories">0</span> kcal</h2>
                </div>
                
                <div id="meal-planner-grid">
                    
                    <div class="card meal-section">
                        <h3>Breakfast</h3>
                        <ul class="meal-list" id="breakfast-list"></ul>
                        <form class="add-meal-form" data-meal-type="breakfast">
                            <input type="text" placeholder="Meal name (e.g., Oatmeal)" required>
                            <input type="number" min="1" placeholder="Calories" required>
                            <button type="submit" class="btn-primary" style="margin-top: 10px; width: 100%;">Add Breakfast</button>
                        </form>
                    </div>

                    <div class="card meal-section">
                        <h3>Lunch</h3>
                        <ul class="meal-list" id="lunch-list"></ul>
                        <form class="add-meal-form" data-meal-type="lunch">
                            <input type="text" placeholder="Meal name (e.g., Salad)" required>
                            <input type="number" min="1" placeholder="Calories" required>
                            <button type="submit" class="btn-primary" style="margin-top: 10px; width: 100%;">Add Lunch</button>
                        </form>
                    </div>

                    <div class="card meal-section">
                        <h3>Dinner</h3>
                        <ul class="meal-list" id="dinner-list"></ul>
                        <form class="add-meal-form" data-meal-type="dinner">
                            <input type="text" placeholder="Meal name (e.g., Chicken)" required>
                            <input type="number" min="1" placeholder="Calories" required>
                            <button type="submit" class="btn-primary" style="margin-top: 10px; width: 100%;">Add Dinner</button>
                        </form>
                    </div>

                </div>

                <div style="text-align: center; margin-top: 30px;">
                    <button class="btn-primary" onclick="navigate('insights-summary')">Go to Insights (Page 4) <i class="fas fa-arrow-right"></i></button>
                </div>
            </section>

            <section id="insights-summary" class="section">
                <h2>üìà Insights & Summary</h2>

                <div class="graph-container">
                    <h3>Weekly Activity (Total Duration in Mins)</h3>
                    <div class="bar-chart" id="activity-graph">
                        </div>
                </div>

                <div class="graph-container" id="calorie-graph-container">
                    <h3>Weekly Calorie Intake (Total Calories)</h3>
                    <div class="bar-chart" id="calorie-graph">
                        </div>
                </div>

                <div class="summary-details">
                    <div class="card summary-card">
                        <p class="metric-label">Average Daily Steps</p>
                        <div class="summary-value" id="avg-steps">0</div>
                    </div>
                    <div class="card summary-card">
                        <p class="metric-label">Total Workouts Logged</p>
                        <div class="summary-value" id="total-workouts">0</div>
                    </div>
                    <div class="card summary-card">
                        <p class="metric-label">Average Daily Calories Consumed</p>
                        <div class="summary-value" id="avg-calories-consumed">0</div>
                    </div>
                </div>

                <div style="text-align: center; margin-top: 30px;">
                    <button class="btn-secondary" id="download-summary-btn"><i class="fas fa-download"></i> Download Summary (Simulated)</button>
                    <button class="btn-primary" id="reset-dashboard-btn" style="background-color: #e74c3c;"><i class="fas fa-trash"></i> Reset Dashboard</button>
                </div>

            </section>
        </main>
    </div>

    <div class="modal-overlay" id="custom-modal">
        <div class="modal-content">
            <div class="modal-icon"><i class="fas fa-check-circle"></i></div>
            <h3 id="modal-title">Success</h3>
            <p id="modal-message">Your action was successful!</p>
            <button class="btn-primary" id="modal-close-btn">Close</button>
        </div>
    </div>

    <script>
// --- GLOBAL STATE & DATA ---
// Initialize data from localStorage or use defaults
let wellnessData = JSON.parse(localStorage.getItem('wellnessData')) || {
    steps: 7500,
    caloriesBurned: 350,
    waterIntake: 1.5, // Liters
    goals: {
        steps: 10000,
        caloriesBurned: 500,
        waterIntake: 2
    }
};

let activities = JSON.parse(localStorage.getItem('activities')) || [
    { name: 'Running', duration: 30, calories: 300, time: 'Morning', date: '2025-11-10' },
    { name: 'Yoga', duration: 45, calories: 150, time: 'Afternoon', date: '2025-11-11' },
    { name: 'Cycling', duration: 60, calories: 400, time: 'Evening', date: '2025-11-12' },
    { name: 'Weightlifting', duration: 60, calories: 350, time: 'Morning', date: '2025-11-13' },
    { name: 'Swimming', duration: 40, calories: 320, time: 'Afternoon', date: '2025-11-14' },
    { name: 'Running', duration: 30, calories: 300, time: 'Morning', date: '2025-11-15' },
    { name: 'Meditation', duration: 20, calories: 50, time: 'Evening', date: '2025-11-16' }
];

let meals = JSON.parse(localStorage.getItem('meals')) || {
    breakfast: [
        { name: 'Oatmeal', calories: 250 },
        { name: 'Banana', calories: 100 }
    ],
    lunch: [
        { name: 'Chicken Salad', calories: 450 }
    ],
    dinner: [
        { name: 'Fish & Veggies', calories: 500 }
    ]
};

// Weekly data structure for Page 4 graphs (simulated week)
let weeklyActivityData = [
    { day: 'Mon', duration: 120 },
    { day: 'Tue', duration: 60 },
    { day: 'Wed', duration: 150 },
    { day: 'Thu', duration: 45 },
    { day: 'Fri', duration: 90 },
    { day: 'Sat', duration: 180 },
    { day: 'Sun', duration: 60 }
];

let weeklyCalorieData = [
    { day: 'Mon', calories: 1800 },
    { day: 'Tue', calories: 2100 },
    { day: 'Wed', calories: 1750 },
    { day: 'Thu', calories: 1900 },
    { day: 'Fri', calories: 2200 },
    { day: 'Sat', calories: 2500 },
    { day: 'Sun', calories: 1600 }
];

// --- STORAGE UTILITY ---
function saveState() {
    localStorage.setItem('wellnessData', JSON.stringify(wellnessData));
    localStorage.setItem('activities', JSON.stringify(activities));
    localStorage.setItem('meals', JSON.stringify(meals));
}

// --- NAVIGATION LOGIC ---
function navigate(targetSectionId) {
    document.querySelectorAll('.section').forEach(section => {
        section.classList.remove('active-section');
    });
    document.getElementById(targetSectionId).classList.add('active-section');

    // Update nav button active state
    document.querySelectorAll('#main-nav button').forEach(button => {
        button.classList.remove('active');
        if (button.getAttribute('data-section') === targetSectionId) {
            button.classList.add('active');
        }
    });

    // Run specific initialization functions when navigating
    if (targetSectionId === 'meal-planner') {
        renderMealPlanner();
    } else if (targetSectionId === 'activity-log') {
        renderActivitiesList('all'); // Always render all activities initially
    } else if (targetSectionId === 'insights-summary') {
        renderInsightsGraphs();
    }
}

// Event listeners for main navigation buttons
document.querySelectorAll('#main-nav button').forEach(button => {
    button.addEventListener('click', () => {
        const target = button.getAttribute('data-section');
        navigate(target);
    });
});

// --- CUSTOM MODAL FUNCTIONS ---
const customModal = document.getElementById('custom-modal');
const modalTitle = document.getElementById('modal-title');
const modalMessage = document.getElementById('modal-message');
const modalIcon = customModal.querySelector('.modal-icon i');

function showModal(title, message, isSuccess = true) {
    modalTitle.textContent = title;
    modalMessage.textContent = message;
    
    // Set icon and color
    modalIcon.className = isSuccess ? 'fas fa-check-circle' : 'fas fa-exclamation-triangle';
    modalIcon.style.color = isSuccess ? 'var(--secondary-color)' : '#e74c3c';

    customModal.classList.add('active');
}

document.getElementById('modal-close-btn').addEventListener('click', () => {
    customModal.classList.remove('active');
});

// Close modal on outside click
customModal.addEventListener('click', (e) => {
    if (e.target === customModal) {
        customModal.classList.remove('active');
    }
});


// ----------------------------------------------------------------------
// üìå PAGE 1 ‚Äî Wellness Overview Dashboard
// ----------------------------------------------------------------------

function updateLiveClock() {
    const now = new Date();
    const timeString = now.toLocaleTimeString('en-US', { hour12: false });
    document.getElementById('live-clock').textContent = timeString;
}

function renderWellnessMetrics() {
    const { steps, caloriesBurned, waterIntake, goals } = wellnessData;

    // Helper to update value and progress bar
    const updateMetric = (id, value, goal, unit = '', progressColor = '') => {
        const percent = Math.min(100, Math.round((value / goal) * 100));
        
        document.getElementById(`${id}-value`).textContent = value.toLocaleString() + unit;
        document.getElementById(`${id}-percent`).textContent = `${percent}%`;
        
        const progressBar = document.getElementById(`${id}-progress`);
        progressBar.style.width = `${percent}%`;
        
        if (progressColor) {
            progressBar.style.backgroundColor = progressColor;
        }
    };

    updateMetric('steps', steps, goals.steps);
    updateMetric('calories', caloriesBurned, goals.caloriesBurned);
    updateMetric('water', waterIntake, goals.waterIntake, ' L');
    
    saveState();
}

// Initial setup for Page 1
updateLiveClock();
setInterval(updateLiveClock, 1000); // Clock updates every second
renderWellnessMetrics();


// ----------------------------------------------------------------------
// üìå PAGE 2 ‚Äî Activity Log
// ----------------------------------------------------------------------

function renderActivitiesList(filter) {
    const listEl = document.getElementById('activities-list');
    listEl.innerHTML = ''; // Clear existing list

    let filteredActivities = activities.slice().reverse(); // Reverse for most recent first

    if (filter !== 'all') {
        filteredActivities = filteredActivities.filter(a => a.time === filter);
    }
    
    if (filteredActivities.length === 0) {
        listEl.innerHTML = `<li class="activity-item" style="justify-content: center; color: var(--light-text-color);">No activities logged for this period.</li>`;
        return;
    }

    filteredActivities.forEach(activity => {
        const li = document.createElement('li');
        li.classList.add('activity-item');
        li.innerHTML = `
            <span class="activity-time-tag">${activity.time}</span>
            <div class="activity-details">
                <div class="activity-name">${activity.name}</div>
                <div class="activity-meta">Duration: ${activity.duration} mins | Calories: ${activity.calories} kcal | Date: ${activity.date}</div>
            </div>
        `;
        listEl.appendChild(li);
    });
}

// Filter button logic
document.querySelectorAll('.activity-filter-btn').forEach(button => {
    button.addEventListener('click', function() {
        // Update active class
        document.querySelectorAll('.activity-filter-btn').forEach(btn => btn.classList.remove('active'));
        this.classList.add('active');
        
        // Render filtered list
        const filter = this.getAttribute('data-filter');
        renderActivitiesList(filter);
    });
});

// Add Activity Form Submission
document.getElementById('add-activity-form').addEventListener('submit', function(e) {
    e.preventDefault();

    const nameInput = document.getElementById('activity-name');
    const durationInput = document.getElementById('activity-duration');
    const caloriesInput = document.getElementById('activity-calories');

    const name = nameInput.value.trim();
    const duration = parseInt(durationInput.value);
    const calories = parseInt(caloriesInput.value);

    // Basic validation
    if (!name || isNaN(duration) || duration <= 0 || isNaN(calories) || calories <= 0) {
        showModal('Validation Error', 'Please ensure all fields are filled correctly (duration and calories must be positive numbers).', false);
        return;
    }

    // Determine time of day for the new activity
    const hour = new Date().getHours();
    let timeOfDay;
    if (hour >= 5 && hour < 12) {
        timeOfDay = 'Morning';
    } else if (hour >= 12 && hour < 17) {
        timeOfDay = 'Afternoon';
    } else {
        timeOfDay = 'Evening';
    }

    const todayDate = new Date().toISOString().split('T')[0];

    const newActivity = { 
        name, 
        duration, 
        calories, 
        time: timeOfDay, 
        date: todayDate 
    };

    activities.push(newActivity);
    saveState();
    
    // Update dashboard metrics (simulated)
    wellnessData.caloriesBurned += calories;
    renderWellnessMetrics();

    // Re-render the list and reset form
    // Keep the current filter active
    const activeFilter = document.querySelector('.activity-filter-btn.active').getAttribute('data-filter');
    renderActivitiesList(activeFilter);
    this.reset();
    
    showModal('Activity Logged!', `Successfully logged ${name} for ${duration} minutes, burning ${calories} kcal.`, true);
});

// Initial render for Page 2
if (document.getElementById('activity-log').classList.contains('active-section')) {
    renderActivitiesList('all');
}


// ----------------------------------------------------------------------
// üìå PAGE 3 ‚Äî Meal Planner
// ----------------------------------------------------------------------

function calculateTotalDailyCalories() {
    let total = 0;
    for (const type in meals) {
        total += meals[type].reduce((sum, meal) => sum + meal.calories, 0);
    }
    return total;
}

function renderMealPlanner() {
    let totalCalories = 0;
    
    // Iterate over meal types (breakfast, lunch, dinner)
    for (const type in meals) {
        const listEl = document.getElementById(`${type}-list`);
        listEl.innerHTML = ''; // Clear previous meals

        if (meals[type].length === 0) {
            listEl.innerHTML = `<li style="font-style: italic; color: var(--light-text-color);">No ${type} logged.</li>`;
        }

        meals[type].forEach((meal, index) => {
            const li = document.createElement('li');
            li.classList.add('meal-item');
            li.innerHTML = `
                <span class="meal-item-name">${meal.name}</span>
                <div class="meal-item-details">
                    <span class="meal-calories">${meal.calories} kcal</span>
                    <button class="remove-meal-btn" data-type="${type}" data-index="${index}"><i class="fas fa-trash-alt"></i></button>
                </div>
            `;
            listEl.appendChild(li);
            totalCalories += meal.calories;
        });
    }

    // Update total calories display
    document.getElementById('total-daily-calories').textContent = totalCalories.toLocaleString();
    saveState();
}

// Event delegation for removing meals
document.getElementById('meal-planner-grid').addEventListener('click', function(e) {
    if (e.target.closest('.remove-meal-btn')) {
        const button = e.target.closest('.remove-meal-btn');
        const type = button.getAttribute('data-type');
        const index = parseInt(button.getAttribute('data-index'));

        if (meals[type] && meals[type].length > index) {
            meals[type].splice(index, 1); // Remove the meal
            renderMealPlanner(); // Re-render to update the list and total
        }
    }
});

// Add Meal Form Submission
document.querySelectorAll('.add-meal-form').forEach(form => {
    form.addEventListener('submit', function(e) {
        e.preventDefault();

        const type = this.getAttribute('data-meal-type');
        const nameInput = this.querySelector('input[type="text"]');
        const caloriesInput = this.querySelector('input[type="number"]');

        const name = nameInput.value.trim();
        const calories = parseInt(caloriesInput.value);

        if (!name || isNaN(calories) || calories <= 0) {
            showModal('Validation Error', 'Please enter a meal name and a positive calorie count.', false);
            return;
        }

        const newMeal = { name, calories };
        meals[type].push(newMeal);

        renderMealPlanner(); // Re-render to show the new meal and update total
        this.reset();
        
        // Show success modal
        showModal('Meal Added!', `Successfully added ${name} to your ${type} plan.`, true);
    });
});

// Initial render for Page 3
if (document.getElementById('meal-planner').classList.contains('active-section')) {
    renderMealPlanner();
}


// ----------------------------------------------------------------------
// üìå PAGE 4 ‚Äî Insights & Summary
// ----------------------------------------------------------------------

function renderBarChart(elementId, data, valueKey, labelKey) {
    const chartEl = document.getElementById(elementId);
    chartEl.innerHTML = ''; // Clear previous bars
    
    // Find the maximum value for scaling the bar heights
    const maxVal = Math.max(...data.map(item => item[valueKey]));
    const maxHeight = 200; // Max height in pixels

    data.forEach(item => {
        const value = item[valueKey];
        const height = (value / maxVal) * maxHeight; // Calculate height relative to max
        
        const bar = document.createElement('div');
        bar.classList.add('bar');
        bar.style.height = `${height}px`;

        bar.innerHTML = `
            <span class="bar-value">${value}</span>
            <span class="bar-label">${item[labelKey]}</span>
        `;
        
        chartEl.appendChild(bar);
    });
}

function calculateSummaryMetrics() {
    // 1. Average Daily Steps (Simulated)
    const avgSteps = Math.round(wellnessData.steps / 7) || 0;
    
    // 2. Total Workouts Logged
    const totalWorkouts = activities.length;

    // 3. Average Daily Calories Consumed (Simulated based on weekly data)
    const totalWeeklyCals = weeklyCalorieData.reduce((sum, day) => sum + day.calories, 0);
    const avgDailyCals = Math.round(totalWeeklyCals / weeklyCalorieData.length) || 0;

    return { avgSteps, totalWorkouts, avgDailyCals };
}

function renderSummary() {
    const { avgSteps, totalWorkouts, avgDailyCals } = calculateSummaryMetrics();
    
    document.getElementById('avg-steps').textContent = avgSteps.toLocaleString();
    document.getElementById('total-workouts').textContent = totalWorkouts.toLocaleString();
    document.getElementById('avg-calories-consumed').textContent = avgDailyCals.toLocaleString() + ' kcal';
}

function renderInsightsGraphs() {
    // Render Activity Graph
    renderBarChart('activity-graph', weeklyActivityData, 'duration', 'day');
    
    // Render Calorie Graph
    renderBarChart('calorie-graph', weeklyCalorieData, 'calories', 'day');
    
    // Render Summary Metrics
    renderSummary();
}

// Reset Dashboard Button
document.getElementById('reset-dashboard-btn').addEventListener('click', () => {
    localStorage.clear();
    sessionStorage.clear();
    
    // Reload the page to reset all JS state to defaults
    location.reload(); 
});

// Download Summary Button (Simulated)
document.getElementById('download-summary-btn').addEventListener('click', () => {
    showModal('Download Complete!', 'Summary has been generated and downloaded as a PDF (Simulated Action).', true);
});

// Initial render for Page 4
if (document.getElementById('insights-summary').classList.contains('active-section')) {
    renderInsightsGraphs();
}


// --- Final Setup ---
// Ensure the initial page load renders the correct section and data
document.addEventListener('DOMContentLoaded', () => {
    // Initial page load checks URL or defaults to 'wellness-overview'
    const initialSection = 'wellness-overview'; 
    navigate(initialSection); 
    
    // Run initial renders for all dynamic content on the active section
    renderWellnessMetrics();
    if (initialSection === 'activity-log') renderActivitiesList('all');
    if (initialSection === 'meal-planner') renderMealPlanner();
    if (initialSection === 'insights-summary') renderInsightsGraphs();
});
    </script>
</body>
</html>